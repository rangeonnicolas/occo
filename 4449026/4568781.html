<div itemprop="articleBody" data-page-indentifier="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/ne-perdez-pas-de-vue-vos-cles" class="js-isRestrictablePage js-course-container js-smilize js-userCanWatchVideo">
<div class="userContent js-userContent">
<p id="r-4703046" >
Ce chapitre est un chapitre de bonnes pratiques. Il n'y a rien de technique ici, mais juste quelqu'un qui vous fait la morale :ange: et vous met en garde contre quelques pièges dans lesquels ne pas tomber !</p>
<p id="r-4703047" >
Plus précisément, je vais vous expliquer l'importance de bien connaître les clés candidates de vos tables.</p>
<video id="r-4709429" src="https://vimeo.com/233478603">
<a href="https://vimeo.com/233478603">
https://vimeo.com/233478603</a>
</video>
<p id="r-4569441" >
</p>
<aside id="r-4569444" data-claire-semantic="warning">
<p id="r-4569443" >
Je ne ferai ici pas la distinction entre les termes<a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/choisissez-votre-cle-primaire-parmi-les-candidates">
<strong>
clé primaire</strong>
et<strong>
clé candidate</strong>
</a>
. En gros, je vais vous dire que pour chaque nouvelle table que vous générez (par des jointures, agrégations, etc.), il faudra bien réfléchir aux clés candidates de celle-ci. Mais en réalité, par besoin de réfléchir à<em>
toutes</em>
les clés candidates de votre table, une seule suffit !</p>
</aside>
<p id="r-4569445" >
</p>
<h3 id="r-4569578" >
Pourquoi les clés sont-elles si importantes ?</h3>
<p id="r-4569446" >
Connaître au moins une clé candidate par table, c'est très important.</p>
<p id="r-4569447" >
Pourquoi ? Parce qu’elles déterminent la nature des objets que vous représentez dans une table.</p>
<p id="r-4569448" >
Imaginez-vous que quelqu'un vous envoie un fichier CSV contenant ce tableau :</p>
<table id="r-4569495" >
<tbody id="r-4569494" >
<tr id="r-4569457" >
<td id="r-4569450" >
<p id="r-4569449" >
<strong>
id_pomme</strong>
</p>
</td>
<td id="r-4569452" >
<p id="r-4569451" >
<strong>
propriétaire</strong>
</p>
</td>
<td id="r-4569454" >
<p id="r-4569453" >
<strong>
couleur</strong>
</p>
</td>
<td id="r-4569456" >
<p id="r-4569455" >
<strong>
masse</strong>
</p>
</td>
</tr>
<tr id="r-4569466" >
<td id="r-4569459" >
<p id="r-4569458" >
1</p>
</td>
<td id="r-4569461" >
<p id="r-4569460" >
Luc</p>
</td>
<td id="r-4569463" >
<p id="r-4569462" >
verte</p>
</td>
<td id="r-4569465" >
<p id="r-4569464" >
130 g</p>
</td>
</tr>
<tr id="r-4569475" >
<td id="r-4569468" >
<p id="r-4569467" >
2</p>
</td>
<td id="r-4569470" >
<p id="r-4569469" >
Luc</p>
</td>
<td id="r-4569472" >
<p id="r-4569471" >
verte</p>
</td>
<td id="r-4569474" >
<p id="r-4569473" >
160 g</p>
</td>
</tr>
<tr id="r-4569484" >
<td id="r-4569477" >
<p id="r-4569476" >
3</p>
</td>
<td id="r-4569479" >
<p id="r-4569478" >
Leila</p>
</td>
<td id="r-4569481" >
<p id="r-4569480" >
rouge</p>
</td>
<td id="r-4569483" >
<p id="r-4569482" >
134 g</p>
</td>
</tr>
<tr id="r-4569493" >
<td id="r-4569486" >
<p id="r-4569485" >
[...]</p>
</td>
<td id="r-4569488" >
<p id="r-4569487" >
[...]</p>
</td>
<td id="r-4569490" >
<p id="r-4569489" >
[...]</p>
</td>
<td id="r-4569492" >
<p id="r-4569491" >
[...]</p>
</td>
</tr>
</tbody>
</table>
<p id="r-4569496" >
Vous vous dites "Cette table représente des pommes : 1 ligne = 1 pomme. La clé primaire est donc<em>
[id_pomme]</em>
".</p>
<p id="r-4569497" >
Vous décidez donc de calculer la masse totale de toutes ces pommes. Vous trouvez<code data-claire-semantic="text">
9.734 kg</code>
.</p>
<p id="r-4569498" >
Sauf que... en explorant un peu plus ce tableau vers le bas, vous découvrez ceci :</p>
<table id="r-4569554" >
<tbody id="r-4569553" >
<tr id="r-4569507" >
<td id="r-4569500" >
<p id="r-4569499" >
<strong>
id_pomme</strong>
</p>
</td>
<td id="r-4569502" >
<p id="r-4569501" >
<strong>
propriétaire</strong>
</p>
</td>
<td id="r-4569504" >
<p id="r-4569503" >
<strong>
couleur</strong>
</p>
</td>
<td id="r-4569506" >
<p id="r-4569505" >
<strong>
masse</strong>
</p>
</td>
</tr>
<tr id="r-4569516" >
<td id="r-4569509" >
<p id="r-4569508" >
[...]</p>
</td>
<td id="r-4569511" >
<p id="r-4569510" >
[...]</p>
</td>
<td id="r-4569513" >
<p id="r-4569512" >
[...]</p>
</td>
<td id="r-4569515" >
<p id="r-4569514" >
[...]</p>
</td>
</tr>
<tr id="r-4569525" >
<td id="r-4569518" >
<p id="r-4569517" >
39</p>
</td>
<td id="r-4569520" >
<p id="r-4569519" >
Yari</p>
</td>
<td id="r-4569522" >
<p id="r-4569521" >
rouge</p>
</td>
<td id="r-4569524" >
<p id="r-4569523" >
134 g</p>
</td>
</tr>
<tr id="r-4569534" >
<td id="r-4569527" >
<p id="r-4569526" >
39</p>
</td>
<td id="r-4569529" >
<p id="r-4569528" >
Doriane</p>
</td>
<td id="r-4569531" >
<p id="r-4569530" >
rouge</p>
</td>
<td id="r-4569533" >
<p id="r-4569532" >
134 g</p>
</td>
</tr>
<tr id="r-4569543" >
<td id="r-4569536" >
<p id="r-4569535" >
40</p>
</td>
<td id="r-4569538" >
<p id="r-4569537" >
Thanh</p>
</td>
<td id="r-4569540" >
<p id="r-4569539" >
jaune</p>
</td>
<td id="r-4569542" >
<p id="r-4569541" >
120 g</p>
</td>
</tr>
<tr id="r-4569552" >
<td id="r-4569545" >
<p id="r-4569544" >
[...]</p>
</td>
<td id="r-4569547" >
<p id="r-4569546" >
[...]</p>
</td>
<td id="r-4569549" >
<p id="r-4569548" >
[...]</p>
</td>
<td id="r-4569551" >
<p id="r-4569550" >
[...]</p>
</td>
</tr>
</tbody>
</table>
<p id="r-4569555" >
Vous découvrez que la pomme<code data-claire-semantic="text">
39</code>
a deux propriétaires : Yari et Doriane.</p>
<p id="r-4569556" >
Vous n'auriez pas supposé une minute qu'une pomme puisse appartenir à 2 personnes en même temps ! Et ça change beaucoup de choses :</p>
<ul id="r-4569567" >
<li id="r-4569558" >
<p id="r-4569557" >
La clé primaire n'est plus<code data-claire-semantic="text">
[id_pomme]</code>
, mais<code data-claire-semantic="text">
[id_pomme, propriétaire]</code>
car<em>
id_pomme</em>
contient des doublons (ici,<code data-claire-semantic="text">
39</code>
est en double dans<em>
id_pomme</em>
).</p>
</li>
<li id="r-4569566" >
<p id="r-4569565" >
La table en votre possession ne représente plus des pommes, mais plutôt des associations pomme-propriétaire (voir le chapitre sur les<a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/utilisez-les-tables-dassociation">
tables d'associations</a>
). Votre supposition<code data-claire-semantic="text">
1 ligne = 1 pomme</code>
n'est plus vraie !</p>
</li>
</ul>
<p id="r-4569568" >
Ainsi, cette table contient de la redondance, car l'information<em>
"la pomme 39 pèse 134 g"</em>
est présente sur 2 lignes. Mais vous ne pouvez pas vraiment blâmer l'expéditeur du fichier, car il n'a pas lu<a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/evitez-la-redondance">
le chapitre sur la redondance</a>
!</p>
<p id="r-4569574" >
Pire encore, le calcul de la masse totale est totalement faussé, car vous avez comptabilisé la masse de la pomme 39 en double (et peut-être pas que la pomme 39 !). A cause de votre erreur de calcul, vous perdez la confiance de la personne qui vous a demandé de calculer la masse totale... Bref, c'est le désastre ! :'(</p>
<aside id="r-4569576" data-claire-semantic="information">
<p id="r-4569575" >
Conclusion : il fallait vérifier avant tout calcul si<code data-claire-semantic="text">
[id_pomme]</code>
était une clé candidate. Ici, ce n'était pas le cas. Comment faire ? Descendez jusqu'à la section<em>
Aller plus loin.</em>
;)</p>
</aside>
<p id="r-4569577" >
</p>
<h3 id="r-4628214" >
Les clés dans les jointures</h3>
<p id="r-4628084" >
Bien connaître ses clés, c'est également très important lors des jointures.</p>
<p id="r-4628206" >
En général, on effectue une jointure :</p>
<ul id="r-4628211" >
<li id="r-4628208" >
<p id="r-4628207" >
d'une clé étrangère d'une table A...</p>
</li>
<li id="r-4628210" >
<p id="r-4628209" >
.... vers la clé primaire (ou vers une clé candidate) d'une table B.</p>
</li>
</ul>
<p id="r-4628221" >
Dans ce cas, le nombre de lignes de la table que vous obtiendrez aura :</p>
<ul id="r-4628226" >
<li id="r-4628223" >
<p id="r-4628222" >
<em>
autant</em>
, ou<em>
moins</em>
de lignes que A si vous faites une<strong>
jointure interne</strong>
,</p>
</li>
<li id="r-4628225" >
<p id="r-4628224" >
<em>
autant</em>
de lignes que A si vous faites une<strong>
jointure externe à gauche</strong>
(avec A à gauche).</p>
</li>
</ul>
<p id="r-4628227" >
A la fin de votre jointure, pensez bien à compter le nombre de lignes.</p>
<aside id="r-4628229" data-claire-semantic="error">
<p id="r-4628228" >
Si vous avez plus de lignes que prévu, c’est peut-être que ce que vous pensiez être une clé (primaire ou candidate) sur B n’en est pas une ! Vous risquez de propager cette erreur tout au long de la chaîne de traitement de données !</p>
</aside>
<aside id="r-4628230" data-claire-semantic="information">
<p id="r-4628212" >
J'ai déjà fait cette erreur. Malheureusement, ce n'était pas sur des pommes... Il m'a fallu 1 jour entier pour remonter la chaîne et trouver la source d'un résultat incohérent en bout de chaîne.</p>
</aside>
<p id="r-4628236" >
En règle générale, dans votre condition de jointure</p>
<p id="r-4628237" >
<code data-claire-semantic="text">
A.cle_étrangere = B.cle_candidate</code>
</p>
<p id="r-4628238" >
assurez-vous qu’au moins l’un des 2 termes de part et d’autre du<code data-claire-semantic="text">
=</code>
soit une clé candidate ou primaire.</p>
<p id="r-4628240" >
Si ce n’est pas le cas, ce n'est pas interdit, mais vérifiez bien que vous ne faites pas une erreur de raisonnement. Soyez-sûr que c'est ce dont vous avez vraiment besoin. Surtout, vérifiez bien la table finale en terme de cohérence et surtout en terme de nombre de lignes.</p>
<p id="r-4628246" >
</p>
<h3 id="r-4629016" >
Aller plus loin : tester si un groupe d'attributs est une clé candidate</h3>
<h4 id="r-4629023" >
Comment vérifier si un groupe d'attributs G est une clé candidate ?</h4>
<p id="r-4629013" >
Pour le savoir, faites une projection sur G (en gros, supprimez les colonnes qui ne sont pas G), puis regardez s'il y a des doublons.</p>
<aside id="r-4629022" data-claire-semantic="information">
<p id="r-4629021" >
Dans la table donnée plus haut, la projection sur [id_pomme] donne la table suivante :</p>
<table id="r-4629045" >
<tbody id="r-4629044" >
<tr id="r-4629028" >
<td id="r-4629027" >
<p id="r-4629026" >
<strong>
id_pomme</strong>
</p>
</td>
</tr>
<tr id="r-4629031" >
<td id="r-4629030" >
<p id="r-4629029" >
[...]</p>
</td>
</tr>
<tr id="r-4629034" >
<td id="r-4629033" >
<p id="r-4629032" >
39</p>
</td>
</tr>
<tr id="r-4629037" >
<td id="r-4629036" >
<p id="r-4629035" >
39</p>
</td>
</tr>
<tr id="r-4629040" >
<td id="r-4629039" >
<p id="r-4629038" >
40</p>
</td>
</tr>
<tr id="r-4629043" >
<td id="r-4629042" >
<p id="r-4629041" >
[...]</p>
</td>
</tr>
</tbody>
</table>
<p id="r-4629046" >
Elle contient au moins un doublon<code data-claire-semantic="text">
(39)</code>
.</p>
</aside>
<p id="r-4629051" >
S'il y a des doublons, alors votre G n'est pas une clé.</p>
<p id="r-4629052" >
S'il n'y a pas de doublons, alors il y a deux possibilités :</p>
<ol id="r-4629057" >
<li id="r-4629054" >
<p id="r-4629053" >
Si vous êtes sûrs qu'aucune nouvelle ligne ne sera ajoutée, alors vous pouvez considérer que G est une clé.</p>
</li>
<li id="r-4629056" >
<p id="r-4629055" >
Si d'autres lignes seront peut-être ajoutées par la suite, il faut prendre contact avec celui (celle) qui a conçu la table, ou regarder dans la documentation qu'il (elle) a écrit, pour savoir si G est une clé, ou pour savoir ce que représente une ligne.</p>
</li>
</ol>
<div id="r-4629059" data-claire-semantic="question">
<p id="r-4629058" >
Oui, mais comment vérifier si une table contient des doublons ?</p>
</div>
<h4 id="r-4629015" >
Vérifier si une table contient des doublons</h4>
<p id="r-4628087" >
Si votre table contient beaucoup de lignes, il est difficile de détecter à l’œil nu les doublons ! Voici donc une recette à implémenter dans votre langage de programmation préféré :</p>
<ol id="r-4628094" >
<li id="r-4628089" >
<p id="r-4628088" >
Comptez le nombre de lignes de votre table.</p>
</li>
<li id="r-4628091" >
<p id="r-4628090" >
Supprimez les doublons.</p>
</li>
<li id="r-4628093" >
<p id="r-4628092" >
Re-comptez le nombre de lignes de votre table.</p>
</li>
</ol>
<p id="r-4628095" >
Si le nombre de lignes de l'étape 1 est différent de l'étape 3, alors votre table contenait des doublons !</p>
<aside id="r-4628104" data-claire-semantic="information">
<p id="r-4628096" >
Beaucoup de langages d'analyse de données permettent d’éliminer facilement les doublons d'une table :</p>
<ul id="r-4628103" >
<li id="r-4628098" >
<p id="r-4628097" >
En SQL, il faut employer le mot utiliser<a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/lancez-votre-premiere-requete-avec-select-from-et-where">
SELECT DISTINCT</a>
.</p>
</li>
<li id="r-4628100" >
<p id="r-4628099" >
En R, il faut utiliser la fonction<code data-claire-semantic="text">
unique()</code>
.</p>
</li>
<li id="r-4628102" >
<p id="r-4628101" >
En Python, il faut employer la méthode<code data-claire-semantic="text">
drop_duplicates()</code>
de la librairie<a href="/courses/4449026/parts/4568781/pandas.pydata.org">
Pandas</a>
.</p>
</li>
</ul>
</aside>
<p id="r-4628105" >
</p>
<p id="r-4628106" >
</p>
<h3 id="r-4619571" >
En résumé</h3>
<ul id="r-4619570" >
<li id="r-4619567" >
<p id="r-4619566" >
A chaque nouvelle table (que vous générez vous-même, ou que vous découvrez), connaissez au moins une<strong>
clé candidate</strong>
! Vous saurez ainsi ce que représente une ligne.</p>
</li>
<li id="r-4628248" >
<p id="r-4628247" >
Il y a une méthode pour vérifier si un groupe d'attributs est une<strong>
clé</strong>
ou non.</p>
</li>
<li id="r-4628250" >
<p id="r-4628249" >
A la suite d'une<strong>
jointure</strong>
, vérifiez bien le nombre de lignes obtenues.</p>
</li>
<li id="r-4619569" >
<p id="r-4619568" >
Lorsque vous faites une<strong>
jointure</strong>
sur autre chose qu'une clé étrangère, faites très attention à ce que vous faites !</p>
</li>
</ul>
<p id="r-4628241" >
</p>
</div>
<div class="js-courseSelementActions sideActions">
<ul class="sideActions__container">
<li>
<a class="sideActions__item js-courseElementActions-copyUrl js-tooltip" href="#" data-tooltip="Copier le lien" data-tooltip-done="Lien copié !">
#</a>
</li>
</ul>
</div>
</div>
