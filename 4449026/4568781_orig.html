<div itemprop="articleBody" data-page-indentifier="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/ne-perdez-pas-de-vue-vos-cles" class="js-isRestrictablePage js-course-container js-smilize js-userCanWatchVideo">
<div class="userContent js-userContent">
<p id="r-4703046" data-claire-element-id="8544331">Ce chapitre est un chapitre de bonnes pratiques. Il n'y a rien de technique ici, mais juste quelqu'un qui vous fait la morale :ange: et vous met en garde contre quelques pièges dans lesquels ne pas tomber !</p><p id="r-4703047" data-claire-element-id="8544332">Plus précisément, je vais vous expliquer l'importance de bien connaître les clés candidates de vos tables.</p><video id="r-4709429" data-claire-element-id="8559327" src="https://vimeo.com/233478603"><a href="https://vimeo.com/233478603">https://vimeo.com/233478603</a></video><p id="r-4569441" data-claire-element-id="8544334"> </p><aside id="r-4569444" data-claire-element-id="8333153" data-claire-semantic="warning"><p id="r-4569443" data-claire-element-id="8333152">Je ne ferai ici pas la distinction entre les termes <a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/choisissez-votre-cle-primaire-parmi-les-candidates"><strong>clé primaire</strong> et <strong>clé candidate</strong></a>. En gros, je vais vous dire que pour chaque nouvelle table que vous générez (par des jointures, agrégations, etc.), il faudra bien réfléchir aux clés candidates de celle-ci. Mais en réalité, par besoin de réfléchir à <em>toutes</em> les clés candidates de votre table, une seule suffit !</p></aside><p id="r-4569445" data-claire-element-id="8199035"> </p><h3 id="r-4569578" data-claire-element-id="8538393">Pourquoi les clés sont-elles si importantes ?</h3><p id="r-4569446" data-claire-element-id="8199036">Connaître au moins une clé candidate par table, c'est très important.</p><p id="r-4569447" data-claire-element-id="8199037">Pourquoi ? Parce qu’elles déterminent la nature des objets que vous représentez dans une table.</p><p id="r-4569448" data-claire-element-id="8199038">Imaginez-vous que quelqu'un vous envoie un fichier CSV contenant ce tableau :</p><table id="r-4569495" data-claire-element-id="8199085"><tbody id="r-4569494" data-claire-element-id="8199084"><tr id="r-4569457" data-claire-element-id="8199047"><td id="r-4569450" data-claire-element-id="8199040"><p id="r-4569449" data-claire-element-id="8199039"><strong>id_pomme</strong></p></td><td id="r-4569452" data-claire-element-id="8199042"><p id="r-4569451" data-claire-element-id="8199041"><strong>propriétaire</strong></p></td><td id="r-4569454" data-claire-element-id="8199044"><p id="r-4569453" data-claire-element-id="8199043"><strong>couleur</strong></p></td><td id="r-4569456" data-claire-element-id="8199046"><p id="r-4569455" data-claire-element-id="8199045"><strong>masse</strong></p></td></tr><tr id="r-4569466" data-claire-element-id="8199056"><td id="r-4569459" data-claire-element-id="8199049"><p id="r-4569458" data-claire-element-id="8199048"> 1</p></td><td id="r-4569461" data-claire-element-id="8199051"><p id="r-4569460" data-claire-element-id="8199050"> Luc</p></td><td id="r-4569463" data-claire-element-id="8199053"><p id="r-4569462" data-claire-element-id="8199052">verte</p></td><td id="r-4569465" data-claire-element-id="8199055"><p id="r-4569464" data-claire-element-id="8199054">130 g</p></td></tr><tr id="r-4569475" data-claire-element-id="8199065"><td id="r-4569468" data-claire-element-id="8199058"><p id="r-4569467" data-claire-element-id="8199057"> 2</p></td><td id="r-4569470" data-claire-element-id="8199060"><p id="r-4569469" data-claire-element-id="8199059"> Luc</p></td><td id="r-4569472" data-claire-element-id="8199062"><p id="r-4569471" data-claire-element-id="8199061">verte</p></td><td id="r-4569474" data-claire-element-id="8199064"><p id="r-4569473" data-claire-element-id="8199063">160 g</p></td></tr><tr id="r-4569484" data-claire-element-id="8199074"><td id="r-4569477" data-claire-element-id="8199067"><p id="r-4569476" data-claire-element-id="8199066"> 3</p></td><td id="r-4569479" data-claire-element-id="8199069"><p id="r-4569478" data-claire-element-id="8199068">Leila</p></td><td id="r-4569481" data-claire-element-id="8199071"><p id="r-4569480" data-claire-element-id="8199070">rouge</p></td><td id="r-4569483" data-claire-element-id="8199073"><p id="r-4569482" data-claire-element-id="8199072"> 134 g</p></td></tr><tr id="r-4569493" data-claire-element-id="8199083"><td id="r-4569486" data-claire-element-id="8199076"><p id="r-4569485" data-claire-element-id="8199075"> [...]</p></td><td id="r-4569488" data-claire-element-id="8199078"><p id="r-4569487" data-claire-element-id="8199077"> [...]</p></td><td id="r-4569490" data-claire-element-id="8199080"><p id="r-4569489" data-claire-element-id="8199079"> [...]</p></td><td id="r-4569492" data-claire-element-id="8199082"><p id="r-4569491" data-claire-element-id="8199081"> [...]</p></td></tr></tbody></table><p id="r-4569496" data-claire-element-id="8333154">Vous vous dites "Cette table représente des pommes : 1 ligne = 1 pomme. La clé primaire est donc <em>[id_pomme]</em>".</p><p id="r-4569497" data-claire-element-id="8538382">Vous décidez donc de calculer la masse totale de toutes ces pommes. Vous trouvez <code data-claire-semantic="text">9.734 kg</code>.</p><p id="r-4569498" data-claire-element-id="8538383"> Sauf que... en explorant un peu plus ce tableau vers le bas, vous découvrez ceci :</p><table id="r-4569554" data-claire-element-id="8199144"><tbody id="r-4569553" data-claire-element-id="8199143"><tr id="r-4569507" data-claire-element-id="8199097"><td id="r-4569500" data-claire-element-id="8199090"><p id="r-4569499" data-claire-element-id="8199089"><strong>id_pomme</strong></p></td><td id="r-4569502" data-claire-element-id="8199092"><p id="r-4569501" data-claire-element-id="8199091"><strong>propriétaire</strong></p></td><td id="r-4569504" data-claire-element-id="8199094"><p id="r-4569503" data-claire-element-id="8199093"><strong>couleur</strong></p></td><td id="r-4569506" data-claire-element-id="8199096"><p id="r-4569505" data-claire-element-id="8199095"><strong>masse</strong></p></td></tr><tr id="r-4569516" data-claire-element-id="8199106"><td id="r-4569509" data-claire-element-id="8199099"><p id="r-4569508" data-claire-element-id="8199098">[...]</p></td><td id="r-4569511" data-claire-element-id="8199101"><p id="r-4569510" data-claire-element-id="8199100">[...]</p></td><td id="r-4569513" data-claire-element-id="8199103"><p id="r-4569512" data-claire-element-id="8199102">[...]</p></td><td id="r-4569515" data-claire-element-id="8199105"><p id="r-4569514" data-claire-element-id="8199104">[...]</p></td></tr><tr id="r-4569525" data-claire-element-id="8199115"><td id="r-4569518" data-claire-element-id="8199108"><p id="r-4569517" data-claire-element-id="8199107">39</p></td><td id="r-4569520" data-claire-element-id="8199110"><p id="r-4569519" data-claire-element-id="8199109">Yari</p></td><td id="r-4569522" data-claire-element-id="8199112"><p id="r-4569521" data-claire-element-id="8199111">rouge</p></td><td id="r-4569524" data-claire-element-id="8199114"><p id="r-4569523" data-claire-element-id="8199113">134 g</p></td></tr><tr id="r-4569534" data-claire-element-id="8199124"><td id="r-4569527" data-claire-element-id="8199117"><p id="r-4569526" data-claire-element-id="8199116">39</p></td><td id="r-4569529" data-claire-element-id="8199119"><p id="r-4569528" data-claire-element-id="8199118">Doriane</p></td><td id="r-4569531" data-claire-element-id="8199121"><p id="r-4569530" data-claire-element-id="8199120">rouge</p></td><td id="r-4569533" data-claire-element-id="8199123"><p id="r-4569532" data-claire-element-id="8199122">134 g</p></td></tr><tr id="r-4569543" data-claire-element-id="8199133"><td id="r-4569536" data-claire-element-id="8199126"><p id="r-4569535" data-claire-element-id="8199125">40</p></td><td id="r-4569538" data-claire-element-id="8199128"><p id="r-4569537" data-claire-element-id="8199127">Thanh</p></td><td id="r-4569540" data-claire-element-id="8199130"><p id="r-4569539" data-claire-element-id="8199129">jaune</p></td><td id="r-4569542" data-claire-element-id="8199132"><p id="r-4569541" data-claire-element-id="8199131">120 g</p></td></tr><tr id="r-4569552" data-claire-element-id="8199142"><td id="r-4569545" data-claire-element-id="8199135"><p id="r-4569544" data-claire-element-id="8199134">[...]</p></td><td id="r-4569547" data-claire-element-id="8199137"><p id="r-4569546" data-claire-element-id="8199136">[...]</p></td><td id="r-4569549" data-claire-element-id="8199139"><p id="r-4569548" data-claire-element-id="8199138">[...]</p></td><td id="r-4569551" data-claire-element-id="8199141"><p id="r-4569550" data-claire-element-id="8199140">[...]</p></td></tr></tbody></table><p id="r-4569555" data-claire-element-id="8538384">Vous découvrez que la pomme <code data-claire-semantic="text">39</code> a deux propriétaires : Yari et Doriane.</p><p id="r-4569556" data-claire-element-id="8199146">Vous n'auriez pas supposé une minute qu'une pomme puisse appartenir à 2 personnes en même temps ! Et ça change beaucoup de choses :</p><ul id="r-4569567" data-claire-element-id="8538389"><li id="r-4569558" data-claire-element-id="8538386"><p id="r-4569557" data-claire-element-id="8538385">La clé primaire n'est plus <code data-claire-semantic="text">[id_pomme]</code>, mais <code data-claire-semantic="text">[id_pomme, propriétaire]</code> car <em>id_pomme</em> contient des doublons (ici,<code data-claire-semantic="text">39</code> est en double dans<em> id_pomme</em>).</p></li><li id="r-4569566" data-claire-element-id="8538388"><p id="r-4569565" data-claire-element-id="8538387">La table en votre possession ne représente plus des pommes, mais plutôt des associations pomme-propriétaire (voir le chapitre sur les <a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/utilisez-les-tables-dassociation">tables d'associations</a>). Votre supposition<code data-claire-semantic="text">1 ligne = 1 pomme</code> n'est plus vraie !</p></li></ul><p id="r-4569568" data-claire-element-id="8538390">Ainsi, cette table contient de la redondance, car l'information <em>"la pomme 39 pèse 134 g"</em> est présente sur 2 lignes. Mais vous ne pouvez pas vraiment blâmer l'expéditeur du fichier, car il n'a pas lu <a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/evitez-la-redondance">le chapitre sur la redondance</a> !</p><p id="r-4569574" data-claire-element-id="8202201">Pire encore, le calcul de la masse totale est totalement faussé, car vous avez comptabilisé la masse de la pomme 39 en double (et peut-être pas que la pomme 39 !). A cause de votre erreur de calcul, vous perdez la confiance de la personne qui vous a demandé de calculer la masse totale... Bref, c'est le désastre ! :'(</p><aside id="r-4569576" data-claire-element-id="8538392" data-claire-semantic="information"><p id="r-4569575" data-claire-element-id="8538391">Conclusion : il fallait vérifier avant tout calcul si <code data-claire-semantic="text">[id_pomme]</code> était une clé candidate. Ici, ce n'était pas le cas. Comment faire ? Descendez jusqu'à la section <em>Aller plus loin.</em> ;)</p></aside><p id="r-4569577" data-claire-element-id="8199167"> </p><h3 id="r-4628214" data-claire-element-id="8538440">Les clés dans les jointures</h3><p id="r-4628084" data-claire-element-id="8357422">Bien connaître ses clés, c'est également très important lors des jointures.</p><p id="r-4628206" data-claire-element-id="8538402">En général, on effectue une jointure :</p><ul id="r-4628211" data-claire-element-id="8538434"><li id="r-4628208" data-claire-element-id="8538433"><p id="r-4628207" data-claire-element-id="8538432">d'une clé étrangère d'une table A...</p></li><li id="r-4628210" data-claire-element-id="8359822"><p id="r-4628209" data-claire-element-id="8359821">.... vers la clé primaire (ou vers une clé candidate) d'une table B.</p></li></ul><p id="r-4628221" data-claire-element-id="8357481">Dans ce cas, le nombre de lignes de la table que vous obtiendrez aura :</p><ul id="r-4628226" data-claire-element-id="8357486"><li id="r-4628223" data-claire-element-id="8357483"><p id="r-4628222" data-claire-element-id="8357482"><em>autant</em>, ou <em>moins</em> de lignes que A si vous faites une <strong>jointure interne</strong>,</p></li><li id="r-4628225" data-claire-element-id="8357485"><p id="r-4628224" data-claire-element-id="8357484"><em>autant</em> de lignes que A si vous faites une <strong>jointure externe à gauche</strong> (avec A à gauche).</p></li></ul><p id="r-4628227" data-claire-element-id="8359824">A la fin de votre jointure, pensez bien à compter le nombre de lignes.</p><aside id="r-4628229" data-claire-element-id="8538436" data-claire-semantic="error"><p id="r-4628228" data-claire-element-id="8538435">Si vous avez plus de lignes que prévu, c’est peut-être que ce que vous pensiez être une clé (primaire ou candidate) sur B n’en est pas une ! Vous risquez de propager cette erreur tout au long de la chaîne de traitement de données !</p></aside><aside id="r-4628230" data-claire-element-id="8357502" data-claire-semantic="information"><p id="r-4628212" data-claire-element-id="8357501"> J'ai déjà fait cette erreur. Malheureusement, ce n'était pas sur des pommes... Il m'a fallu 1 jour entier pour remonter la chaîne et trouver la source d'un résultat incohérent en bout de chaîne.</p></aside><p id="r-4628236" data-claire-element-id="8538437">En règle générale, dans votre condition de jointure</p><p id="r-4628237" data-claire-element-id="8357542"><code data-claire-semantic="text">A.cle_étrangere = B.cle_candidate</code></p><p id="r-4628238" data-claire-element-id="8538438">assurez-vous qu’au moins l’un des 2 termes de part et d’autre du <code data-claire-semantic="text">=</code> soit une clé candidate ou primaire.</p><p id="r-4628240" data-claire-element-id="8538439">Si ce n’est pas le cas, ce n'est pas interdit, mais vérifiez bien que vous ne faites pas une erreur de raisonnement. Soyez-sûr que c'est ce dont vous avez vraiment besoin. Surtout, vérifiez bien la table finale en terme de cohérence et surtout en terme de nombre de lignes.</p><p id="r-4628246" data-claire-element-id="8357562"> </p><h3 id="r-4629016" data-claire-element-id="8538464">Aller plus loin : tester si un groupe d'attributs est une clé candidate</h3><h4 id="r-4629023" data-claire-element-id="8538444">Comment vérifier si un groupe d'attributs G est une clé candidate ?</h4><p id="r-4629013" data-claire-element-id="8359757">Pour le savoir, faites une projection sur G (en gros, supprimez les colonnes qui ne sont pas G), puis regardez s'il y a des doublons.</p><aside id="r-4629022" data-claire-element-id="8538443" data-claire-semantic="information"><p id="r-4629021" data-claire-element-id="8538441">Dans la table donnée plus haut, la projection sur [id_pomme] donne la table suivante :</p><table id="r-4629045" data-claire-element-id="8359800"><tbody id="r-4629044" data-claire-element-id="8359799"><tr id="r-4629028" data-claire-element-id="8359783"><td id="r-4629027" data-claire-element-id="8359782"><p id="r-4629026" data-claire-element-id="8359781"><strong>id_pomme</strong></p></td></tr><tr id="r-4629031" data-claire-element-id="8359786"><td id="r-4629030" data-claire-element-id="8359785"><p id="r-4629029" data-claire-element-id="8359784">[...]</p></td></tr><tr id="r-4629034" data-claire-element-id="8359789"><td id="r-4629033" data-claire-element-id="8359788"><p id="r-4629032" data-claire-element-id="8359787">39</p></td></tr><tr id="r-4629037" data-claire-element-id="8359792"><td id="r-4629036" data-claire-element-id="8359791"><p id="r-4629035" data-claire-element-id="8359790">39</p></td></tr><tr id="r-4629040" data-claire-element-id="8359795"><td id="r-4629039" data-claire-element-id="8359794"><p id="r-4629038" data-claire-element-id="8359793">40</p></td></tr><tr id="r-4629043" data-claire-element-id="8359798"><td id="r-4629042" data-claire-element-id="8359797"><p id="r-4629041" data-claire-element-id="8359796">[...]</p></td></tr></tbody></table><p id="r-4629046" data-claire-element-id="8538442"> Elle contient au moins un doublon  <code data-claire-semantic="text">(39)</code>  .</p></aside><p id="r-4629051" data-claire-element-id="8359827">S'il y a des doublons, alors votre G n'est pas une clé.</p><p id="r-4629052" data-claire-element-id="8359828">S'il n'y a pas de doublons, alors il y a deux possibilités :</p><ol id="r-4629057" data-claire-element-id="8359833"><li id="r-4629054" data-claire-element-id="8359830"><p id="r-4629053" data-claire-element-id="8359829">Si vous êtes sûrs qu'aucune nouvelle ligne ne sera ajoutée, alors vous pouvez considérer que G est une clé.</p></li><li id="r-4629056" data-claire-element-id="8359832"><p id="r-4629055" data-claire-element-id="8359831">Si d'autres lignes seront peut-être ajoutées par la suite, il faut prendre contact avec celui (celle) qui a conçu la table, ou regarder dans la documentation qu'il (elle) a écrit, pour savoir si G est une clé, ou pour savoir ce que représente une ligne.</p></li></ol><div id="r-4629059" data-claire-element-id="8359835" data-claire-semantic="question"><p id="r-4629058" data-claire-element-id="8359834">Oui, mais comment vérifier si une table contient des doublons ?</p></div><h4 id="r-4629015" data-claire-element-id="8538463">Vérifier si une table contient des doublons</h4><p id="r-4628087" data-claire-element-id="8357119">Si votre table contient beaucoup de lignes, il est difficile de détecter à l’œil nu les doublons ! Voici donc une recette à implémenter dans votre langage de programmation préféré :</p><ol id="r-4628094" data-claire-element-id="8538456"><li id="r-4628089" data-claire-element-id="8357121"><p id="r-4628088" data-claire-element-id="8357120">Comptez le nombre de lignes de votre table.</p></li><li id="r-4628091" data-claire-element-id="8538453"><p id="r-4628090" data-claire-element-id="8538452">Supprimez les doublons.</p></li><li id="r-4628093" data-claire-element-id="8538455"><p id="r-4628092" data-claire-element-id="8538454">Re-comptez le nombre de lignes de votre table.</p></li></ol><p id="r-4628095" data-claire-element-id="8357127">Si le nombre de lignes de l'étape 1 est différent de l'étape 3, alors votre table contenait des doublons !</p><aside id="r-4628104" data-claire-element-id="8538462" data-claire-semantic="information"><p id="r-4628096" data-claire-element-id="8357128">Beaucoup de langages d'analyse de données permettent d’éliminer facilement les doublons d'une table :</p><ul id="r-4628103" data-claire-element-id="8538461"><li id="r-4628098" data-claire-element-id="8357130"><p id="r-4628097" data-claire-element-id="8357129">En SQL, il faut employer le mot utiliser <a href="/courses/initiez-vous-a-lalgebre-relationnelle-avec-le-langage-sql/lancez-votre-premiere-requete-avec-select-from-et-where">SELECT DISTINCT</a>.</p></li><li id="r-4628100" data-claire-element-id="8538458"><p id="r-4628099" data-claire-element-id="8538457">En R, il faut utiliser la fonction <code data-claire-semantic="text">unique()</code>.</p></li><li id="r-4628102" data-claire-element-id="8538460"><p id="r-4628101" data-claire-element-id="8538459">En Python, il faut employer la méthode <code data-claire-semantic="text">drop_duplicates()</code> de la librairie <a href="/courses/4449026/parts/4568781/pandas.pydata.org">Pandas</a>.</p></li></ul></aside><p id="r-4628105" data-claire-element-id="8357137"> </p><p id="r-4628106" data-claire-element-id="8357138"> </p><h3 id="r-4619571" data-claire-element-id="8538475"> En résumé</h3><ul id="r-4619570" data-claire-element-id="8538474"><li id="r-4619567" data-claire-element-id="8538473"><p id="r-4619566" data-claire-element-id="8538472">A chaque nouvelle table (que vous générez vous-même, ou que vous découvrez), connaissez au moins une <strong>clé candidate</strong> ! Vous saurez ainsi ce que représente une ligne.</p></li><li id="r-4628248" data-claire-element-id="8357567"><p id="r-4628247" data-claire-element-id="8357566">Il y a une méthode pour vérifier si un groupe d'attributs est une <strong>clé</strong> ou non.</p></li><li id="r-4628250" data-claire-element-id="8357569"><p id="r-4628249" data-claire-element-id="8357568">A la suite d'une <strong>jointure</strong>, vérifiez bien le nombre de lignes obtenues.</p></li><li id="r-4619569" data-claire-element-id="8357571"><p id="r-4619568" data-claire-element-id="8357570">Lorsque vous faites une <strong>jointure</strong> sur autre chose qu'une clé étrangère, faites très attention à ce que vous faites !</p></li></ul><p id="r-4628241" data-claire-element-id="8357547"> </p>
</div>
<div class="js-courseSelementActions sideActions">
<ul class="sideActions__container">
<li>
<a class="sideActions__item  js-courseElementActions-copyUrl  js-tooltip" href="#" data-tooltip="Copier le lien" data-tooltip-done="Lien copié !">
#
</a>
</li>
</ul>
</div>
</div>